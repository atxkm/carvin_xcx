let app = getApp();
let json = {
  "msg": "success",
  "result": [{
    "id": 1,
    "type": 'vin',
    "openId": "o8KKdxFyle3FnO3ySA6nbqJTmD7Y",
    "result": "[{\"msg\":\"success\",\"result\":{\"vininfo\":{\"bz\":\"\",\"clsbdh\":\"LFV2A11GX53133581\",\"clxh\":\"FV7160CiF E3\",\"clzzrq\":\"2005-12-06 00:00:00.0\",\"createtime\":\"2005-12-08 08:25:42.0\",\"csys\":\"亮银\",\"emissionsid\":0,\"fdjh\":\"BJG 126402\",\"fzrq\":\"2005-12-06 00:00:00.0\",\"gl\":\"68\",\"id\":2,\"page\":null,\"pfbz\":\"GB18352.2-2001\",\"pl\":\"1595\",\"vehiclestatus\":\"3\",\"vintablename\":\"\",\"wzhgzbh\":\"WAB060501133581\"},\"carmodelinfo\":[{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"4扬声器    \",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":219,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":11.98,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":3357,\"simpleName\":\"2004款 CIF 1.6L 手动 都市春天基本型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004},{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"\",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":221,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":10.78,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":3366,\"simpleName\":\"2004款 CIF 1.6L 手动 豪华型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004},{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"铝合金轮毂 手动空调   \",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":24291,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":8.98,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":1133,\"simpleName\":\"2004款 CIF 1.6L 手动 都市春天舒适型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004}]},\"code\":1}]",
    "createtime": 1490452066000,
    "vincode": "LFV2A11GX53133581",
    "page": null
  }, {
    "id": 2,
    "type": "vin",
    "openId": "o8KKdxFyle3FnO3ySA6nbqJTmD7Y",
    "result": "[{\"msg\":\"success\",\"result\":{\"vininfo\":{\"bz\":\"\",\"clsbdh\":\"LFV2A11GX53133581\",\"clxh\":\"FV7160CiF E3\",\"clzzrq\":\"2005-12-06 00:00:00.0\",\"createtime\":\"2005-12-08 08:25:42.0\",\"csys\":\"亮银\",\"emissionsid\":0,\"fdjh\":\"BJG 126402\",\"fzrq\":\"2005-12-06 00:00:00.0\",\"gl\":\"68\",\"id\":2,\"page\":null,\"pfbz\":\"GB18352.2-2001\",\"pl\":\"1595\",\"vehiclestatus\":\"3\",\"vintablename\":\"\",\"wzhgzbh\":\"WAB060501133581\"},\"carmodelinfo\":[{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"4扬声器    \",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":219,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":11.98,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":3357,\"simpleName\":\"2004款 CIF 1.6L 手动 都市春天基本型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004},{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"\",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":221,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":10.78,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":3366,\"simpleName\":\"2004款 CIF 1.6L 手动 豪华型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004},{\"brandId\":84,\"brandName\":\"大众\",\"bright\":\"铝合金轮毂 手动空调   \",\"carType\":2,\"displacement\":1.6,\"emissionsId\":2,\"engineName\":\"BJG\",\"gbm\":\"FV7160CIF E3\",\"id\":24291,\"isCode\":0,\"isShow\":1,\"isSure\":2,\"maxPowerKw\":68,\"mfrsId\":1,\"mfrsName\":\"一汽大众\",\"newPrice\":8.98,\"page\":null,\"productionDate\":\"2004-03-01 00:00:00.0\",\"seats\":5,\"seriesId\":449,\"seriesName\":\"捷达\",\"simpleId\":1133,\"simpleName\":\"2004款 CIF 1.6L 手动 都市春天舒适型(国Ⅲ)\",\"sourceFrom\":1,\"str\":\"\",\"updateTime\":0,\"userId\":0,\"versionYear\":2004}]},\"code\":1}]",
    "createtime": 1490452342000,
    "vincode": "LFV2A11GX53133581",
    "page": null
  }],
  "code": 1
};

Page({
  onLoad: function(e) {
    let list = json.result;
    let gruopJson = {};

    list.forEach(item => {
      item.result = JSON.parse(item.result);
      let date = new Date(item.createtime);
      date = `${date.getFullYear()}年${date.getMonth()}月${date.getDay()}日`;
      item.createdate = date;
      let result = item.result = item.result[0].result;

      if (item.type == 'vin') {
        item.url = `/pages/vehicle/vehicle?result=${JSON.stringify(result)}`;
      } else if (item.type == 'accidVin') {
        let carInfo = {};
        let vinInfo = result.vininfo;
        if (vinInfo != 0) {
          carInfo.vinCode = vinInfo.vincode;
          carInfo.carModel = vinInfo.clxh;

        } else if (result.carmodelinfo != 0) {
          let carModelInfo = result.carmodelinfo[0];
          carInfo.vinCode = carModelInfo.vincode;
          carInfo.carModel = carModelInfo.brandName + carModelInfo.seriesName;

        } else {
          carInfo.vinCode = queryNumber;
          carInfo.carModel = '未查到';
        }

        item.result.carInfo = carInfo;
        item.url = `/pages/accident/accident?result=${JSON.stringify(result)}`;

      } else if (item.type == 'insVin') {
        item.result.carInfo = item.result.insreult[0];
        item.url = `/pages/insurance/insurance?result=${JSON.stringify(result)}`;
      }

      if (gruopJson[date]) {
        gruopJson[date].push(item);
      } else {
        gruopJson[date] = [item];
      }
    });

    let historyList = [];
    for (let key in gruopJson) {
      let item = gruopJson[key];
      historyList.push(item);
    }
    console.log(historyList);
    this.setData({
      historyList: historyList
    });
  },
  navigatTo: function(e) {
    let type = e.currentTarget.dataset.id;
    let url = '';
    switch (type) {
      case 1:
        url = `/pages/vehicle/vehicle?result=${queryNumber}`;
        break;
      case 2:
        url = `/pages/accident/accident?queryNumber=${queryNumber}`;
        break;
      case 3:
        url = `/pages/insurance/insurance?queryNumber=${queryNumber}`;;
    };
    wx.navigateTo({
      url: url
    });
  },
});
